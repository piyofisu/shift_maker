<div class = "new-shift">
  <table>
    <%# 月 %>
    <th><%= Date.today.month %>月</th>

    <tr>
      <th>日付</th>
      <% @dates.each do |date| %>
        <th><%= date.day %>日</th>
      <% end %>
    </tr>
    <tr>
      <th>曜日</th>
      <% @dates.each do |date| %>
        <th><%= @days[date.wday] %></th>
      <% end %>
    </tr>
    <tr>
      <th>スタッフ</th>
      <% if @staffs.empty? %>
        <p>スタッフ未登録</p>
      <% else %>
        <% @staffs.each do |staff| %>
          <tr>
            <td><%= staff.name %></td>
            <%= form_with model: Schedule.new, url: schedules_path, local: true do |f| %>
              <% @dates.each_with_index do |date, i| %>
                <td>
                  <% schedule = staff.schedules.find_by(making_date: date) %>
                  <%= f.hidden_field "schedules[#{i}][id]", value: schedule&.id %>
                  <%= f.hidden_field "schedules[#{i}][making_date]", value: date %>
                  <%= f.collection_select "schedules[#{i}][shiftpattern_id]", Shiftpattern.all, :id, :name, selected: schedule&.shiftpattern_id %>
                </td>
              <% end %>
              <td><%= f.submit "Create Schedule for #{staff.name}" %></td>
            <% end %>
          </tr>
        <% end %>
      <% end %>
    </tr>
  </table>
</div>
<%= link_to 'トップ', root_path%>